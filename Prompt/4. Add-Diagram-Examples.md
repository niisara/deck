
## Purpose
Add interactive MermaidPopover diagrams as inline clickable badges to slides, making technical concepts more engaging and visual during presentations without adding vertical space or requiring scrolling. All diagrams must be styled for dark glassmorphism backgrounds out of the box.

## When to Use This Pattern
Add MermaidPopover diagrams when slides contain:
- Example walkthroughs or calculations
- Step-by-step explanations
- Comparative scenarios
- Formula applications with concrete numbers
- Confusion matrices or tables
- Multi-step processes

## Implementation Pattern

### 1. Identify Target Locations
Look for sections with:
- A "When to Use" section with bullet points
- A "Formula" section with equations and/or bullet points
- A "How It Works" section with explanatory content
- Any informational section with bullet points
- Concrete numerical examples in the speaker notes
- Scenarios comparing different outcomes
- Text in notes that walks through specific cases

### 2. Add Inline Badge with MermaidPopover

**General Structure:**
```tsx
<GSAPAnimated animation="fadeIn" delay={0.6}>
  <div style={{ marginBottom: '0em', position: 'relative' }}>
    <div style={{ position: 'absolute', top: '-5px', right: 0 }}>
      <MermaidPopover
        title="Descriptive Diagram Title"
        diagram={`%%{init: {'theme':'base','themeVariables':{'fontSize':'13px','primaryColor':'#2a2a3a','primaryTextColor':'#f0f0f0','primaryBorderColor':'rgba(255,255,255,0.4)','lineColor':'rgba(255,255,255,0.7)','secondaryColor':'#1e1e2e','tertiaryColor':'#252535','edgeLabelBackground':'rgba(0,0,0,0.6)','clusterBkg':'rgba(30,30,50,0.7)','clusterBorder':'rgba(255,255,255,0.25)'}}}%%
graph TB
    A["Node A"] --> B["Node B"]
    style A fill:#2a2a3a,color:#e0e0e0,stroke:#888888,stroke-width:1.5px
    style B fill:#2a2a3a,color:#e0e0e0,stroke:#888888,stroke-width:1.5px
        `}
      />
    </div>
    <h4>When to Use</h4>
    <ul style={{ fontSize: '0.5em' }}>
      <li>Your existing bullet points here</li>
    </ul>
  </div>
</GSAPAnimated>
```

**Note:** Replace "When to Use" with appropriate heading: "Formula", "How It Works", etc.

### 3. Placement Guidelines
- Add to an existing section (typically "When to Use", "Formula", or "How It Works")
- Make the parent div `position: 'relative'`
- Place MermaidPopover in absolutely positioned div: `top: '-5px', right: 0`
- DO NOT create a separate GSAPAnimated section
- DO NOT add h4 wrapper around the MermaidPopover
- DO NOT add helper text (p tag) below the badge
- The MermaidPopover component itself is clickable and will show a tooltip on hover

### 4. Key Changes from Previous Pattern
‚ùå **OLD (Don't do this):**
```tsx
<GSAPAnimated animation="fadeIn" delay={0.9}>
  <div>
    <h4>
      Example Calculation
      <MermaidPopover ... />
    </h4>
    <p>Click to see...</p>
  </div>
</GSAPAnimated>
```

OR

```tsx
<GSAPAnimated animation="fadeIn" delay={0.3}>
  <div>
    <h4>
      Formula
      <MermaidPopover ... />
    </h4>
    <ul>...</ul>
  </div>
</GSAPAnimated>
```

‚úÖ **NEW (Do this):**
```tsx
<GSAPAnimated animation="fadeIn" delay={0.6}>
  <div style={{ position: 'relative' }}>
    <div style={{ position: 'absolute', top: '-5px', right: 0 }}>
      <MermaidPopover ... />
    </div>
    <h4>When to Use</h4>
    <ul>...</ul>
  </div>
</GSAPAnimated>
```

---

## Dark Mode Diagram Styling Rules

These diagrams render inside a dark glassmorphism popover. They should feel like dimly-lit documents ‚Äî not bright clinical charts.

### 1. Always use the dark `%%{init: ...}%%` block

Use this on **every** diagram:

```
%%{init: {'theme':'base','themeVariables':{'fontSize':'13px','primaryColor':'#2a2a3a','primaryTextColor':'#f0f0f0','primaryBorderColor':'rgba(255,255,255,0.4)','lineColor':'rgba(255,255,255,0.7)','secondaryColor':'#1e1e2e','tertiaryColor':'#252535','edgeLabelBackground':'rgba(0,0,0,0.6)','clusterBkg':'rgba(30,30,50,0.7)','clusterBorder':'rgba(255,255,255,0.25)'}}}%%
```

Key effects:
- `lineColor` ‚Üí connectors and arrows become white/visible
- `primaryBorderColor` ‚Üí default node borders become visible
- `edgeLabelBackground` ‚Üí edge label text readable on dark bg

### 2. Every node must have an explicit `style` line

If a node has no `style` line, add one using the default dark-neutral style:

```
style <NODE_ID> fill:#2a2a3a,color:#e0e0e0,stroke:#888888,stroke-width:1.5px
```

> ‚ö†Ô∏è **Do NOT use `rgba()` in `style` lines.** Mermaid's diagram parser does not support parentheses in style values and will throw a parse error. Use flat hex colors for all stroke values. `rgba()` is only valid inside the `%%{init}%%` JSON block (theme variables).

### 3. Color remapping ‚Äî light/pastel fills to dark equivalents

| Original fill | Replace with | Text color |
|---|---|---|
| `#e3f2fd` (light blue) | `#1a3a5c` | `#fff` |
| `#c8e6c9` (light green) | `#1b4332` | `#d1fae5` |
| `#fff9c4` (light yellow) | `#3d2e00` | `#fde68a` |
| `#ffcdd2` (light red) | `#5c1a1a` | `#fecaca` |
| `#4fc3f7` (bright blue) | `#1a3a5c` | `#fff` |
| `#81c784` (bright green) | `#1b4332` | `#d1fae5` |
| `#ffd700` (gold) | `#3d2e00` | `#fde68a` |
| `#e1bee7` (light purple) | `#2d1b4e` | `#e0c0ff` |
| `#fff` (white) | `#2a2a3a` | `#e0e0e0` |
| `#f5f5f5` (light gray) | `#1e1e2e` | `#e0e0e0` |
| `#1a1a1a` (near-black) | `#0f0f1a` | `#fff` |
| `#c62828` (dark red) | keep | `#fff` |
| any other light/pastel | nearest dark semantic equivalent | light tint |

### 4. Stroke on every node

Every `style` line must include `stroke-width:1.5px` and a flat hex stroke color:

| Node type | Stroke hex |
|---|---|
| Colored/accent fill (blue, amber, red) | `stroke:#aaaaaa` |
| Dark/neutral fill (`#2a2a3a`, `#0f0f1a`) | `stroke:#888888` |
| High-danger fill (`#5c1a1a`, `#c62828`) | `stroke:#bbbbbb` |

> ‚ö†Ô∏è Never use `rgba()` in `style` lines ‚Äî Mermaid's parser cannot handle parentheses there.

### 5. Subgraph containers

If the diagram uses `subgraph` blocks, apply dark fill and colored border:

```
style <SUBGRAPH_ID> fill:#0d1f33,stroke:#777777,stroke-width:2px,color:#e0e0e0
```

Use a colored stroke accent (e.g. `#4da6ff`, `#f5a623`, `#e53935`) if the subgraph carries a semantic meaning (info/warn/danger). Flat hex is required ‚Äî no `rgba()` in style lines.

### 6. Contrast rule (always)

- **Never** use `color:#000` on any node ‚Äî it will be invisible on dark backgrounds
- Light/colored fill ‚Üí `color:#fff` or a light tint matching the fill hue
- Dark fill ‚Üí `color:#fff` or `#e0e0e0`

### Visual Tone

- Node backgrounds: deep navy, charcoal, dark red, dark amber
- Borders: faint white glow
- Text: off-white (`#e0e0e0`, `#f0f0f0`, or light tints)
- Connectors: soft white (`rgba(255,255,255,0.7)`)
- No bright pastels anywhere

---

## Example Templates

### Template 1: Calculation Example
```tsx
<GSAPAnimated animation="fadeIn" delay={0.6}>
  <div style={{ marginBottom: '0em', position: 'relative' }}>
    <div style={{ position: 'absolute', top: '-5px', right: 0 }}>
      <MermaidPopover
        title="Step-by-Step Calculation Example"
        diagram={`%%{init: {'theme':'base','themeVariables':{'fontSize':'14px','primaryColor':'#2a2a3a','primaryTextColor':'#f0f0f0','primaryBorderColor':'rgba(255,255,255,0.4)','lineColor':'rgba(255,255,255,0.7)','secondaryColor':'#1e1e2e','tertiaryColor':'#252535','edgeLabelBackground':'rgba(0,0,0,0.6)','clusterBkg':'rgba(30,30,50,0.7)','clusterBorder':'rgba(255,255,255,0.25)'}}}%%
graph TB
    Input["üìä Input Data"] --> Step1["Step 1: Calculate X"]
    Step1 --> Step2["Step 2: Calculate Y"]
    Step2 --> Result["‚úÖ Result = Z"]
    style Input fill:#1a3a5c,color:#fff,stroke:#aaaaaa,stroke-width:1.5px
    style Step1 fill:#2a2a3a,color:#e0e0e0,stroke:#888888,stroke-width:1.5px
    style Step2 fill:#2a2a3a,color:#e0e0e0,stroke:#888888,stroke-width:1.5px
    style Result fill:#1b4332,color:#d1fae5,stroke:#aaaaaa,stroke-width:1.5px
        `}
      />
    </div>
    <h4>When to Use</h4>
    <ul style={{ fontSize: '0.5em' }}>
      <li>Your use case here</li>
    </ul>
  </div>
</GSAPAnimated>
```

### Template 2: Multiple Scenarios
```tsx
<GSAPAnimated animation="slideInRight" delay={0.6}>
  <div style={{ marginBottom: '0em', position: 'relative' }}>
    <div style={{ position: 'absolute', top: '-5px', right: 0 }}>
      <MermaidPopover
        title="Scenario Comparison Examples"
        diagram={`%%{init: {'theme':'base','themeVariables':{'fontSize':'13px','primaryColor':'#2a2a3a','primaryTextColor':'#f0f0f0','primaryBorderColor':'rgba(255,255,255,0.4)','lineColor':'rgba(255,255,255,0.7)','secondaryColor':'#1e1e2e','tertiaryColor':'#252535','edgeLabelBackground':'rgba(0,0,0,0.6)','clusterBkg':'rgba(30,30,50,0.7)','clusterBorder':'rgba(255,255,255,0.25)'}}}%%
graph TB
    subgraph Case1["‚úÖ Success Case"]
        C1["Input ‚Üí Process ‚Üí Output ‚úÖ"]
    end
    
    subgraph Case2["‚ùå Failure Case"]
        C2["Input ‚Üí Error ‚Üí Failed ‚ùå"]
    end
    
    style Case1 fill:#0d1f33,stroke:#4da6ff,stroke-width:2px,color:#d1fae5
    style Case2 fill:#0d1f33,stroke:#e53935,stroke-width:2px,color:#fecaca
    style C1 fill:#1b4332,color:#d1fae5,stroke:#aaaaaa,stroke-width:1.5px
    style C2 fill:#5c1a1a,color:#fecaca,stroke:#bbbbbb,stroke-width:1.5px
        `}
      />
    </div>
    <h4>When to Use</h4>
    <ul style={{ fontSize: '0.5em' }}>
      <li>Your use cases</li>
    </ul>
  </div>
</GSAPAnimated>
```

### Template 3: Confusion Matrix / Table
```tsx
<GSAPAnimated animation="slideInBottom" delay={0.7}>
  <div style={{ marginBottom: '0em', position: 'relative' }}>
    <div style={{ position: 'absolute', top: '-5px', right: 0 }}>
      <MermaidPopover
        title="Confusion Matrix Example"
        diagram={`%%{init: {'theme':'base','themeVariables':{'fontSize':'13px','primaryColor':'#2a2a3a','primaryTextColor':'#f0f0f0','primaryBorderColor':'rgba(255,255,255,0.4)','lineColor':'rgba(255,255,255,0.7)','secondaryColor':'#1e1e2e','tertiaryColor':'#252535','edgeLabelBackground':'rgba(0,0,0,0.6)','clusterBkg':'rgba(30,30,50,0.7)','clusterBorder':'rgba(255,255,255,0.25)'}}}%%
graph TB
    subgraph Matrix["Matrix (Actual vs Predicted)"]
        Header["     | A | B | C |"]
        Row1["A    | 90| 5 | 2 |"]
        Row2["B    | 8 | 85| 3 |"]
        Row3["C    | 1 | 2 | 92|"]
    end
    
    subgraph Insight["Key Insights"]
        I1["‚úÖ A: 93% accuracy"]
        I2["‚úÖ C: 97% accuracy"]
        I3["‚ö†Ô∏è Main confusion: A ‚ÜîÔ∏è B"]
    end
    
    Matrix --> Insight
    
    style Matrix fill:#0d1f33,stroke:#4da6ff,stroke-width:2px,color:#e0e0e0
    style Insight fill:#0d1f33,stroke:#f5a623,stroke-width:2px,color:#e0e0e0
    style Header fill:#2a2a3a,color:#e0e0e0,stroke:#888888,stroke-width:1.5px
    style Row1 fill:#2a2a3a,color:#e0e0e0,stroke:#888888,stroke-width:1.5px
    style Row2 fill:#2a2a3a,color:#e0e0e0,stroke:#888888,stroke-width:1.5px
    style Row3 fill:#2a2a3a,color:#e0e0e0,stroke:#888888,stroke-width:1.5px
    style I1 fill:#1b4332,color:#d1fae5,stroke:#aaaaaa,stroke-width:1.5px
    style I2 fill:#1b4332,color:#d1fae5,stroke:#aaaaaa,stroke-width:1.5px
    style I3 fill:#3d2e00,color:#fde68a,stroke:#aaaaaa,stroke-width:1.5px
        `}
      />
    </div>
    <h4>When to Use</h4>
    <ul style={{ fontSize: '0.5em' }}>
      <li>Diagnosing patterns and issues</li>
    </ul>
  </div>
</GSAPAnimated>
```

### Template 4: Multi-Step Process
```tsx
<GSAPAnimated animation="fadeIn" delay={0.6}>
  <div style={{ marginBottom: '0em', position: 'relative' }}>
    <div style={{ position: 'absolute', top: '-5px', right: 0 }}>
      <MermaidPopover
        title="Multi-Step Workflow Example"
        diagram={`%%{init: {'theme':'base','themeVariables':{'fontSize':'14px','primaryColor':'#2a2a3a','primaryTextColor':'#f0f0f0','primaryBorderColor':'rgba(255,255,255,0.4)','lineColor':'rgba(255,255,255,0.7)','secondaryColor':'#1e1e2e','tertiaryColor':'#252535','edgeLabelBackground':'rgba(0,0,0,0.6)','clusterBkg':'rgba(30,30,50,0.7)','clusterBorder':'rgba(255,255,255,0.25)'}}}%%
flowchart LR
    A["Input"] --> B["Process 1"]
    B --> C["Process 2"]
    C --> D["Process 3"]
    D --> E["Output"]
    style A fill:#1a3a5c,color:#fff,stroke:#aaaaaa,stroke-width:1.5px
    style B fill:#2a2a3a,color:#e0e0e0,stroke:#888888,stroke-width:1.5px
    style C fill:#2a2a3a,color:#e0e0e0,stroke:#888888,stroke-width:1.5px
    style D fill:#2a2a3a,color:#e0e0e0,stroke:#888888,stroke-width:1.5px
    style E fill:#1b4332,color:#d1fae5,stroke:#aaaaaa,stroke-width:1.5px
        `}
      />
    </div>
    <h4>When to Use</h4>
    <ul style={{ fontSize: '0.5em' }}>
      <li>Your use cases</li>
    </ul>
  </div>
</GSAPAnimated>
```

### Template 5: Formula Section
```tsx
<GSAPAnimated animation="slideInLeft" delay={0.3}>
  <div style={{ marginBottom: '0em', position: 'relative' }}>
    <div style={{ position: 'absolute', top: '-5px', right: 0 }}>
      <MermaidPopover
        title="Calculation Process Visualization"
        diagram={`%%{init: {'theme':'base','themeVariables':{'fontSize':'14px','primaryColor':'#2a2a3a','primaryTextColor':'#f0f0f0','primaryBorderColor':'rgba(255,255,255,0.4)','lineColor':'rgba(255,255,255,0.7)','secondaryColor':'#1e1e2e','tertiaryColor':'#252535','edgeLabelBackground':'rgba(0,0,0,0.6)','clusterBkg':'rgba(30,30,50,0.7)','clusterBorder':'rgba(255,255,255,0.25)'}}}%%
flowchart TB
    A["ü§ñ Input"] --> B{"Decision?"}
    B -->|Yes| C["‚úÖ Case A"]
    B -->|No| D["‚ùå Case B"]
    C --> E["üìä Result = X"]
    D --> E
    style A fill:#1a3a5c,color:#fff,stroke:#aaaaaa,stroke-width:1.5px
    style B fill:#3d2e00,color:#fde68a,stroke:#aaaaaa,stroke-width:1.5px
    style C fill:#1b4332,color:#d1fae5,stroke:#aaaaaa,stroke-width:1.5px
    style D fill:#5c1a1a,color:#fecaca,stroke:#bbbbbb,stroke-width:1.5px
    style E fill:#3d2e00,color:#fde68a,stroke:#aaaaaa,stroke-width:1.5px`}
      />
    </div>
    <h4>Formula</h4>
    <ul style={{ fontSize: '0.5em' }}>
      <li><strong>Variable:</strong> description</li>
      <p className="formula-left" dangerouslySetInnerHTML={{ __html: '\\[\\text{Formula} = \\frac{A}{B}\\]' }} />
    </ul>
  </div>
</GSAPAnimated>
```

### Template 6: How It Works Section
```tsx
<GSAPAnimated animation="scaleIn" delay={0.4}>
  <div style={{ marginBottom: '0em', position: 'relative' }}>
    <div style={{ position: 'absolute', top: '-5px', right: 0 }}>
      <MermaidPopover
        title="Process Flow Example"
        diagram={`%%{init: {'theme':'base','themeVariables':{'fontSize':'14px','primaryColor':'#2a2a3a','primaryTextColor':'#f0f0f0','primaryBorderColor':'rgba(255,255,255,0.4)','lineColor':'rgba(255,255,255,0.7)','secondaryColor':'#1e1e2e','tertiaryColor':'#252535','edgeLabelBackground':'rgba(0,0,0,0.6)','clusterBkg':'rgba(30,30,50,0.7)','clusterBorder':'rgba(255,255,255,0.25)'}}}%%
flowchart LR
    A["üìã Input"] --> B["üîÄ Process"]
    B --> C{"Check?"}
    C -->|"‚úÖ"| D["Success"]
    C -->|"‚ùå"| E["Fail"]
    style A fill:#1a3a5c,color:#fff,stroke:#aaaaaa,stroke-width:1.5px
    style B fill:#2d1b4e,color:#e0c0ff,stroke:#aaaaaa,stroke-width:1.5px
    style C fill:#3d2e00,color:#fde68a,stroke:#aaaaaa,stroke-width:1.5px
    style D fill:#1b4332,color:#d1fae5,stroke:#aaaaaa,stroke-width:1.5px
    style E fill:#5c1a1a,color:#fecaca,stroke:#bbbbbb,stroke-width:1.5px`}
      />
    </div>
    <h4>How It Works</h4>
    <ul style={{ fontSize: '0.5em' }}>
      <li>Step-by-step explanation</li>
      <li>Key concepts</li>
    </ul>
  </div>
</GSAPAnimated>
```

## Color Scheme Guidelines (Dark Mode)

### Standard Colors (copy these for consistency)
```
Success/Correct: fill:#1b4332,color:#d1fae5,stroke:#aaaaaa,stroke-width:1.5px
Error/Wrong:     fill:#5c1a1a,color:#fecaca,stroke:#bbbbbb,stroke-width:1.5px
Warning/Caution: fill:#3d2e00,color:#fde68a,stroke:#aaaaaa,stroke-width:1.5px
Info/Neutral:    fill:#1a3a5c,color:#fff,stroke:#aaaaaa,stroke-width:1.5px
Input/Data:      fill:#1a3a5c,color:#fff,stroke:#aaaaaa,stroke-width:1.5px
Output/Result:   fill:#1b4332,color:#d1fae5,stroke:#aaaaaa,stroke-width:1.5px
Process:         fill:#2d1b4e,color:#e0c0ff,stroke:#aaaaaa,stroke-width:1.5px
Highlight:       fill:#3d2e00,color:#fde68a,stroke:#aaaaaa,stroke-width:1.5px
Default/Neutral: fill:#2a2a3a,color:#e0e0e0,stroke:#888888,stroke-width:1.5px
Danger:          fill:#c62828,color:#fff,stroke:#bbbbbb,stroke-width:1.5px
Subgraph (info): fill:#0d1f33,stroke:#4da6ff,stroke-width:2px,color:#e0e0e0
Subgraph (warn): fill:#0d1f33,stroke:#f5a623,stroke-width:2px,color:#e0e0e0
Subgraph (danger): fill:#0d1f33,stroke:#e53935,stroke-width:2px,color:#e0e0e0
Subgraph (neutral): fill:#0d1f33,stroke:#777777,stroke-width:2px,color:#e0e0e0
```

### Color Usage Tips
- ‚úÖ Green tones (`#1b4332`): correct answers, success cases
- ‚ùå Red tones (`#5c1a1a`): errors, failures, wrong predictions
- üîµ Blue tones (`#1a3a5c`): general information, inputs
- üü° Amber tones (`#3d2e00`): results, key metrics, highlights, decisions
- üü† Orange/Danger (`#c62828`): critical warnings
- üü£ Purple tones (`#2d1b4e`): processes, transformations
- ‚¨õ Neutral (`#2a2a3a`): default/unstyled nodes, intermediate steps

## Best Practices

### Diagram Design
1. **Keep it simple** - Max 5-7 nodes per diagram
2. **Use emojis** - Makes diagrams more engaging (üìä üìà ‚úÖ ‚ùå ‚ö†Ô∏è üîß)
3. **Label clearly** - Use descriptive text in nodes
4. **Show flow** - Use arrows to indicate relationships
5. **Subgraphs for grouping** - Group related elements

### Code Organization
1. **Font size**: Use 13-14px for readability
2. **Positioning**: Use `position: 'absolute', top: '-5px', right: 0` for badge placement
3. **Parent container**: Set `position: 'relative'` on parent div
4. **No extra wrappers**: Place MermaidPopover directly without h4 or p tags

### Dark Mode Rules
1. **Always include** the full dark `%%{init}%%` block with all theme variables
2. **Every node** must have an explicit `style` line ‚Äî no unstyled nodes
3. **Never use `color:#000`** ‚Äî invisible on dark backgrounds
4. **Never use `rgba()` in `style` lines** ‚Äî only valid in `%%{init}%%` JSON block
5. **Always include `stroke` and `stroke-width:1.5px`** on every node style
6. **No bright pastels** ‚Äî remap all light fills to dark semantic equivalents

### Integration
1. **Don't remove notes** - Keep existing speaker notes intact
2. **Placement timing** - Add after main content, before closing tag
3. **Delay sequencing** - Use appropriate delays (0.9, 1.0) for last items

## Implementation Steps

### Step 1: Identify Target Section
Look for an existing section in the slide that could host the badge, typically:
- "When to Use" section
- Any informational section with bullet points
- The last GSAPAnimated section before closing

### Step 2: Modify Existing Section
1. Add `position: 'relative'` to the section's div style
2. Add absolutely positioned div at the start with MermaidPopover
3. Keep all existing content below the badge div

### Step 3: Create Diagram
1. Review speaker notes for concrete examples
2. Design a clear, simple Mermaid diagram
3. Use dark mode colors from the Color Scheme Guidelines
4. Ensure every node has an explicit `style` line
5. Include the full dark `%%{init}%%` block
6. Test that the diagram is readable on dark background

### Step 4: Verify
1. Check that badge appears in top-right corner
2. Verify hover tooltip works
3. Ensure click opens diagram popover
4. Confirm no scrolling is needed on the slide
5. Verify all text is visible on dark background (no `color:#000`)
6. Verify no `rgba()` in any `style` line

## Common Mermaid Diagram Types

### Flowchart (TB = Top to Bottom)
```
flowchart TB
    A --> B
    B --> C
```

### Flowchart (LR = Left to Right)
```
flowchart LR
    A --> B --> C
```

### Graph with Subgraphs
```
graph TB
    subgraph Section1["Title"]
        A["Content"]
    end
    subgraph Section2["Title"]
        B["Content"]
    end
    Section1 --> Section2
```

### Decision Flow
```
flowchart TB
    A["Input"] --> B{"Decision?"}
    B -->|"Yes"| C["Path 1"]
    B -->|"No"| D["Path 2"]
```

## Checklist Before Committing

- [ ] Diagram is relevant to the example in notes
- [ ] Colors use dark mode palette (no light pastels, no `color:#000`)
- [ ] Full dark `%%{init}%%` block is present on every diagram
- [ ] Every node has an explicit `style` line
- [ ] Every `style` line includes `stroke` and `stroke-width:1.5px`
- [ ] No `rgba()` used in any `style` line (only in `%%{init}%%` block)
- [ ] Font size is 13-14px
- [ ] Title is descriptive and clear
- [ ] Badge is positioned absolutely in top-right corner
- [ ] Parent div has `position: 'relative'`
- [ ] No h4 wrapper around MermaidPopover
- [ ] No helper p tag below the badge
- [ ] Code is properly indented
- [ ] No syntax errors in Mermaid code
- [ ] Emojis render correctly
- [ ] Diagram viewable without scrolling
- [ ] Badge doesn't add vertical space to slide

## Example: Complete Implementation

### Example 1: "When to Use" Section
From NER Metrics Deck - Exact Match Score:

**Before (Old Pattern - Don't Use):**
```tsx
<GSAPAnimated animation="fadeIn" delay={0.7}>
  <div style={{ marginBottom: '0em' }}>
    <h4>When to Use</h4>
    <ul style={{ fontSize: '0.5em' }}>
      <li>End-to-end reliability</li>
    </ul>
  </div>
</GSAPAnimated>

<GSAPAnimated animation="fadeIn" delay={1.0}>
  <div style={{ marginBottom: '0em' }}>
    <h4>
      Example Walkthrough
      <MermaidPopover title="..." diagram={`...`} />
    </h4>
    <p style={{ fontSize: '0.65em', fontStyle: 'italic' }}>Click to see...</p>
  </div>
</GSAPAnimated>
```

**After (New Pattern - Use This):**
```tsx
<GSAPAnimated animation="fadeIn" delay={0.7}>
  <div style={{ marginBottom: '0em', position: 'relative' }}>
    <div style={{ position: 'absolute', top: '-5px', right: 0 }}>
      <MermaidPopover
        title="Exact Match Example: 4 Predictions"
        diagram={`%%{init: {'theme':'base','themeVariables':{'fontSize':'14px','primaryColor':'#2a2a3a','primaryTextColor':'#f0f0f0','primaryBorderColor':'rgba(255,255,255,0.4)','lineColor':'rgba(255,255,255,0.7)','secondaryColor':'#1e1e2e','tertiaryColor':'#252535','edgeLabelBackground':'rgba(0,0,0,0.6)','clusterBkg':'rgba(30,30,50,0.7)','clusterBorder':'rgba(255,255,255,0.25)'}}}%%
graph TB
    subgraph Truth["üéØ Ground Truth"]
        GT["Apple=ORG | Tim Cook=PERSON | Tesla=ORG"]
    end
    
    subgraph P1["Prediction 1: ‚úÖ EM = 1"]
        P1E["Apple=ORG | Tim Cook=PERSON | Tesla=ORG"]
        P1R["‚úÖ Perfect Match!"]
    end
    
    subgraph P2["Prediction 2: ‚ùå EM = 0"]
        P2E["Apple=ORG | Tim Cook=PERSON | Tesla=LOC"]
        P2R["‚ùå Wrong Label"]
    end
    
    Truth --> P1
    Truth --> P2
    
    style Truth fill:#0d1f33,stroke:#4da6ff,stroke-width:2px,color:#e0e0e0
    style P1 fill:#0d1f33,stroke:#4da6ff,stroke-width:2px,color:#d1fae5
    style P2 fill:#0d1f33,stroke:#e53935,stroke-width:2px,color:#fecaca
    style GT fill:#1a3a5c,color:#fff,stroke:#aaaaaa,stroke-width:1.5px
    style P1E fill:#1b4332,color:#d1fae5,stroke:#aaaaaa,stroke-width:1.5px
    style P1R fill:#1b4332,color:#d1fae5,stroke:#aaaaaa,stroke-width:1.5px
    style P2E fill:#5c1a1a,color:#fecaca,stroke:#bbbbbb,stroke-width:1.5px
    style P2R fill:#5c1a1a,color:#fecaca,stroke:#bbbbbb,stroke-width:1.5px`}
      />
    </div>
    <h4>When to Use</h4>
    <ul style={{ fontSize: '0.5em' }}>
      <li>End-to-end reliability</li>
    </ul>
  </div>
</GSAPAnimated>
```

### Example 2: "Formula" Section
From NER Metrics Deck - Precision:

**Before (Old Pattern - Don't Use):**
```tsx
<GSAPAnimated animation="slideInLeft" delay={0.3}>
  <div style={{ marginBottom: '0em' }}>
    <h4>
      Formula
      <MermaidPopover
        title="Precision Calculation"
        diagram={`...`}
      />
    </h4>
    <ul style={{ fontSize: '0.5em' }}>
      <li><strong>TP:</strong> true positives</li>
      <p className="formula-left" dangerouslySetInnerHTML={{ __html: '\\[\\text{Precision} = \\frac{TP}{TP + FP}\\]' }} />
    </ul>
  </div>
</GSAPAnimated>
```

**After (New Pattern - Use This):**
```tsx
<GSAPAnimated animation="slideInLeft" delay={0.3}>
  <div style={{ marginBottom: '0em', position: 'relative' }}>
    <div style={{ position: 'absolute', top: '-5px', right: 0 }}>
      <MermaidPopover
        title="Precision Calculation"
        diagram={`%%{init: {'theme':'base','themeVariables':{'fontSize':'14px','primaryColor':'#2a2a3a','primaryTextColor':'#f0f0f0','primaryBorderColor':'rgba(255,255,255,0.4)','lineColor':'rgba(255,255,255,0.7)','secondaryColor':'#1e1e2e','tertiaryColor':'#252535','edgeLabelBackground':'rgba(0,0,0,0.6)','clusterBkg':'rgba(30,30,50,0.7)','clusterBorder':'rgba(255,255,255,0.25)'}}}%%
flowchart TB
    A["ü§ñ Model Predictions"] --> B{"Correct?"}
    B -->|Yes| C["‚úÖ TP = 8"]
    B -->|No| D["‚ùå FP = 2"]
    C --> E["üìä Precision = 8/10 = 80%"]
    D --> E
    style A fill:#1a3a5c,color:#fff,stroke:#aaaaaa,stroke-width:1.5px
    style B fill:#3d2e00,color:#fde68a,stroke:#aaaaaa,stroke-width:1.5px
    style C fill:#1b4332,color:#d1fae5,stroke:#aaaaaa,stroke-width:1.5px
    style D fill:#5c1a1a,color:#fecaca,stroke:#bbbbbb,stroke-width:1.5px
    style E fill:#3d2e00,color:#fde68a,stroke:#aaaaaa,stroke-width:1.5px`}
      />
    </div>
    <h4>Formula</h4>
    <ul style={{ fontSize: '0.5em' }}>
      <li><strong>TP:</strong> true positives</li>
      <p className="formula-left" dangerouslySetInnerHTML={{ __html: '\\[\\text{Precision} = \\frac{TP}{TP + FP}\\]' }} />
    </ul>
  </div>
</GSAPAnimated>
```

**Key Differences:**
1. ‚úÖ Single GSAPAnimated section (not two)
2. ‚úÖ Parent div has `position: 'relative'`
3. ‚úÖ Badge div has `position: 'absolute', top: '-5px', right: 0`
4. ‚úÖ MermaidPopover has no h4 wrapper
5. ‚úÖ No helper p tag
6. ‚úÖ Badge appears in top-right corner of existing content
7. ‚úÖ Works for any section type: "When to Use", "Formula", "How It Works", etc.
8. ‚úÖ Full dark `%%{init}%%` block with all theme variables
9. ‚úÖ Every node has an explicit `style` line with dark fills
10. ‚úÖ No `color:#000` anywhere ‚Äî all text is light/off-white
11. ‚úÖ No `rgba()` in `style` lines ‚Äî only flat hex colors
12. ‚úÖ Every `style` line includes `stroke` and `stroke-width:1.5px`

## Dark Mode ‚Äî Before and After Quick Reference

**Before (light mode ‚Äî DON'T use):**
```
%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'13px'}}}%%
flowchart TB
    A["üí≠ Thought"] --> B["üó£Ô∏è Speech"]
    style A fill:#e3f2fd,color:#000
    style B fill:#c8e6c9,color:#000
```

**After (dark mode ‚Äî USE THIS):**
```
%%{init: {'theme':'base','themeVariables':{'fontSize':'13px','primaryColor':'#2a2a3a','primaryTextColor':'#f0f0f0','primaryBorderColor':'rgba(255,255,255,0.4)','lineColor':'rgba(255,255,255,0.7)','secondaryColor':'#1e1e2e','tertiaryColor':'#252535','edgeLabelBackground':'rgba(0,0,0,0.6)','clusterBkg':'rgba(30,30,50,0.7)','clusterBorder':'rgba(255,255,255,0.25)'}}}%%
flowchart TB
    A["üí≠ Thought"] --> B["üó£Ô∏è Speech"]
    style A fill:#1a3a5c,color:#fff,stroke:#aaaaaa,stroke-width:1.5px
    style B fill:#1b4332,color:#d1fae5,stroke:#aaaaaa,stroke-width:1.5px
```

## Quick Reference Commands

### Common Section Types to Target
All MermaidPopover diagrams should be right-aligned in the following sections:
- **"When to Use"** - Use cases and application scenarios
- **"Formula"** - Mathematical formulas with visual explanations
- **"How It Works"** - Process flows and mechanisms
- **Any section with examples** - Example calculations, walkthroughs, comparisons

### Search in VS Code
Search for sections that need conversion:
```
Search: "<h4>\n                    (Formula|How It Works|Example)"
Use regex enabled
```

Or search for old pattern:
```
Search: "Formula\n                    <MermaidPopover"
Use regex disabled
```

### Multi-Replace Pattern
Use `multi_replace_string_in_file` for multiple edits:
- Identify all sections with MermaidPopover in h4 wrappers
- Create replacement array
- Execute all changes at once

## Notes
- Keep diagrams focused on ONE concept per diagram
- Test in browser to ensure proper rendering
- Verify mobile responsiveness if needed
- Consider accessibility (color contrast ‚Äî all text must be light on dark fills)
